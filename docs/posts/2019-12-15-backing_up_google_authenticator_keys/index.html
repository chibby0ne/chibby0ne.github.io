<!doctype html><html><head><title>Backing up Google Authenticators's Keys from an Android Phone</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><meta property="og:title" content="Backing up Google Authenticators's Keys from an Android Phone"><meta property="og:description" content="I wanted to backup my 2FA codes stored in Google&rsquo;s Authenticator app. I don&rsquo;t want lose access to my accounts, in case I lose that phone.
Sure there are also the backup codes, which are given/shown whenever 2FA is set up, and are intended to be used on a rainy day such as when your phone dies, gets stolen, or simply wiped accidentally or even on purpose but they just forgot about the 2FA codes living there (not speaking from personal experience at all of course :cry: )."><meta property="og:type" content="article"><meta property="og:url" content="https://www.antoniojgutierrez.com/posts/2019-12-15-backing_up_google_authenticator_keys/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-12-15T00:00:00+00:00"><meta property="article:modified_time" content="2019-12-15T00:00:00+00:00"><meta property="og:site_name" content="Murmurations of Neurons"><meta name=twitter:card content="summary"><meta name=twitter:title content="Backing up Google Authenticators's Keys from an Android Phone"><meta name=twitter:description content="I wanted to backup my 2FA codes stored in Google&rsquo;s Authenticator app. I don&rsquo;t want lose access to my accounts, in case I lose that phone.
Sure there are also the backup codes, which are given/shown whenever 2FA is set up, and are intended to be used on a rainy day such as when your phone dies, gets stolen, or simply wiped accidentally or even on purpose but they just forgot about the 2FA codes living there (not speaking from personal experience at all of course :cry: )."><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-55399960-1","auto"),ga("send","pageview"))</script><script src=/js/toc.js></script>
<link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Material+Icons"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script src=https://cdn.jsdelivr.net/npm/vue-disqus@3/dist/vue-disqus.js></script>
<a rel=me href=https://hachyderm.io/@chibby0ne></a></head><body><div id=app><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item false" href=/about>About me</a>
<a class="a-block drawer-menu-item active" href=/posts>Archive</a>
<a class="a-block drawer-menu-item false" href=/categories>Categories</a>
<a class="a-block drawer-menu-item false" href=/tags>Tags</a>
<a class="a-block drawer-menu-item false" href=/cv>CV</a>
<a class="a-block drawer-menu-item false" href=https://github.com/chibby0ne/CTFs>CTFs</a>
<a class="a-block drawer-menu-item false" href=/index.xml>RSS Feed</a><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#prerequisites class=nav-prerequisites>Prerequisites</a></li><li><a href=#run-adb-as-root class=nav-run-adb-as-root>Run adb as root</a></li><li><a href=#fetching-the-database class=nav-fetching-the-database>Fetching the database</a></li><li><a href=#opening-the-database class=nav-opening-the-database>Opening the database</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a id=navTitle class=navbar-brand href=https://www.antoniojgutierrez.com/>Murmurations of Neurons</a>
<button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://www.antoniojgutierrez.com/><div class=single-column-header-title>Murmurations of Neurons</div><div class=single-column-header-subtitle>An exploration of ideas and thoughts on programming, computers, nature and life in general</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only><div class=post-title>Backing up Google Authenticators's Keys from an Android Phone<div class=post-meta><time itemprop=datePublished>2019-12-15 00:00</time>
<i class=material-icons>schedule</i>
5 min
20 s.</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><p>I wanted to backup my 2FA codes stored in Google&rsquo;s Authenticator app. I don&rsquo;t
want lose access to my accounts, in case I lose that phone.</p><p>Sure there are also the backup codes, which are given/shown whenever 2FA is
set up, and are intended to be used on a rainy day such as when your
phone dies, gets stolen, or simply wiped accidentally or even on purpose but
they just forgot about the 2FA codes living there (not speaking from personal
experience at all of course :cry: ). Unfortunately, many people don&rsquo;t pay too
much attention to these, myself included.</p><p>I <strong>strongly encourage you to store those backup codes</strong> because you
never know when you&rsquo;re going to need them. They have saved me in the past
from being able to access an account when my phone battery died, I had no
charger and needed to access it urgently.</p><p>But in those cases where everything goes wrong, well you just have to reset
all accounts where you have 2FA, i.e: reset passwords and somehow prove that
you are who you say you are and not a malicious attacker that obtained the
passwords for those accounts (which is kind of a tricky situation for many
services since they don&rsquo;t want to be accidentally victims of a social
engineering attack trying to collaborate with the so-claimed user).</p><p>Hopefully this serves as enough warning and encouragement to backup your 2FA
or simply write down the backup codes. If you get anything out of this post,
let it be that.</p><p>Now back to backing up the 2FA keys in Google Authenticator (GA) app: the main
advantage of this approach being that you don&rsquo;t have to change/edit or add any
new device into any of your accounts, but instead you simply add the keys
manually to another 2FA app whether it lives in app in your phone, a desktop
app or somewhere else.</p><p>You also don&rsquo;t need to use any of your <em>limited</em> backup codes in case you need
access and don&rsquo;t have that one phone with all the 2FA keys at hand in that
moment.</p><h1 id=prerequisites>Prerequisites</h1><p>This guide assumes you have rooted your Android phone.</p><p>If you don&rsquo;t want to do this due to security concerns, then your only option
is to use the backup codes and that&rsquo;s the end of this road for you.</p><p>If you don&rsquo;t mind rooting your phone, and you haven&rsquo;t there are many ways of
doing so, a simple duckduckgo search will lead you down the rabbithole.</p><p>In addition we will need
<a href=https://developer.android.com/studio/command-line/adb>adb</a> adb i.e: android
debug bridge. This is part of
the <code>android-tools</code> package in Arch Linux. You can also download and install
it as part of the platform-tools from the <a href=https://developer.android.com/studio/releases/platform-tools>Android
website</a></p><p>This guide also assumes your phone is connected to the computer and you have
USB debugging enabled (For more detailed steps please check this <a href=https://developer.android.com/studio/debug/dev-options>official
android guide</a>.</p><h1 id=run-adb-as-root>Run adb as root</h1><p>First of we need to run adb as root. This is easier said that done.</p><p>For this we can run <code>adb root</code> in a terminal, but it might be the case that after we do that
and try to fetch GA&rsquo;s database we get the following error:</p><pre tabindex=0><code>$ adb pull /data/data/com.google.android.apps.authenticator2/databases/databases
adb: error: failed to stat remote object &#39;/data/data/com.google.android.apps.authenticator2/databases/databases&#39;: Permission denied
</code></pre><pre tabindex=0><code>$ sudo adb shell
AndroidPhone:/ $ ls -lh
ls: ./init.rc: Permission denied
ls: ./init: Permission denied
ls: ./ueventd.rc: Permission denied
</code></pre><p>You can also tell that the session is <strong>not</strong> a root session because the
prompt ends with <code>$</code> instead of <code>#</code>.</p><pre tabindex=0><code>$ adb root
adbd cannot run as root in production builds
</code></pre><pre tabindex=0><code>$ adb shell &#34;su&#34;
Permission denied
</code></pre><p>In my particular case, this is an issue caused of having Magisck Hide enabled,
mentioned in this <a href=https://github.com/topjohnwu/Magisk/issues/425#issuecomment-409101558>Github
issue</a>.</p><p>In case you&rsquo;re wondering Magisck Hide is part of
<a href=https://www.xda-developers.com/how-to-use-magisk/>Magisck</a> and is a feature
that &ldquo;<em>allows you put a cloaking device on root permissions for certain
apps.</em>&rdquo;. Very useful for banking apps, for instance, which don&rsquo;t allow you to
login on a rooted device.</p><p>So I decided to disable Magisck Hide for now and reboot.</p><p>Afterwards I was able to start an adb root session:</p><pre tabindex=0><code>$ adb root
restarting adbd as root
timeout expired while waiting for device
</code></pre><p>And then checking the prompt for the <code>#</code> at the end.</p><pre tabindex=0><code>$ adb shell
OnePlus3:/ # ls -lh
total 2.7M
dr-xr-xr-x  90 root   root      0 1972-06-20 21:28 acct
lrwxrwxrwx   1 root   root     11 1970-01-01 01:00 bin -&gt; /system/bin
lrwxrwxrwx   1 root   root     19 1970-01-01 01:00 bt_firmware -&gt; /vendor/bt_firmware
lrwxrwxrwx   1 root   root     50 1970-01-01 01:00 bugreports -&gt; /data/user_de/0/com.android.shell/files/bugreports
</code></pre><h1 id=fetching-the-database>Fetching the database</h1><p>Afterwards I was able to pull the database, and I noticed that it hadn&rsquo;t been
modified since many months ago, even though I had recently added new 2FA entries,
after trying to open it I only found a handful of 2FA keys, but I also noticed
something else.</p><p>There were two additional files next to the <code>database</code> file: a <code>-wal</code> and a <code>-shm</code> file.</p><p>After some more duckduckgo searching I found a well written in a well written and
useful <a href=https://medium.com/@Zredna/browsing-your-android-apps-database-3c67aa3f4a3c>Medium
post</a>
by <a href=https://medium.com/@Zredna>@Zredna</a>, in which he explore sqlite
databases in android apps.</p><p>In it he explains that the <code>-wal</code> file, is used for the <a href=https://en.wikipedia.org/wiki/Write-ahead_logging>write-ahead
logging</a>, which is a
technique for providing atomicity and durability in databases, part of the
<a href=https://en.wikipedia.org/wiki/ACID>ACID properties</a>, and Wikipedia explains
that the technique relies on first writing the changes in the log <strong>before</strong>
writing them in the database. Kind of the equivalent of journaling in filesystems.
In short the directory looked something like this:</p><pre tabindex=0><code>OnePlus3:/data/data/com.google.android.apps.authenticator2/databases# ls -lh
total 2.7M
lrwxrwxrwx   1 root   root     6K  1970-01-01 01:00 databases
lrwxrwxrwx   1 root   root     80  1970-01-01 01:00 databases-shm
lrwxrwxrwx   1 root   root     10K 1970-01-01 01:00 databases-wal
</code></pre><p>As to the meaning of the <code>-shm</code> file, that is a <strong>shared-memory file</strong> and is
used by the sqlite databases when operating in WAL mode, used as an index of
the WAL file. You can read more about it the [sqlite tempfiles
documentation](here: <a href=https://www.sqlite.org/tempfiles.html>https://www.sqlite.org/tempfiles.html</a>)</p><p>So that required actually fetching both of those extra files in order to get a
complete picture of the current database state.</p><h1 id=opening-the-database>Opening the database</h1><p>As per the blog, we need to commit the changes from the <code>wal</code> file to the
database file, in order to do that we run the command:</p><pre tabindex=0><code>sqlite3 app.db &#34;PRAGMA wal_checkpoint&#34;
</code></pre><p>Afterwards, we can open the database using an interactive sqlite session,
select all the entries from the <code>account</code> table:</p><pre tabindex=0><code>$ sqlite3 ./databases
SQLite version 3.31.1 2019-12-10 19:55:54
Enter &#34;.help&#34; for usage hints.
sqlite&gt; select * from accounts;
</code></pre><p>Or simply save all the values without an interactive session to another file:</p><pre tabindex=0><code>sqlite3 databases &#39;select * from accounts&#39; &gt; 2fa_accounts
</code></pre><p>Which will write a table representation that looks like this:</p><pre tabindex=0><code>$ cat 2fa_accounts
1|Github|asdf12345asdf|0|0|0||Github
2|Twitch|deadbeef101010|0|0|0||Twitch
</code></pre><p>And the 2FA private keys would be the <strong>deadbeef101010</strong> and the
<strong>asdf12345asdf</strong> in this case, which you can then now use in case you move to
a different phone.</p><p>That&rsquo;s it! Hope that helps you in some way!</p><p>PS: These are <strong>not real 2FA private keys</strong> in case you&rsquo;re wondering, potential hacker.</p><hr width=100% id=EOF><p style=color:#777>Last modified on 2019-12-15</p><p class=verify-in-keybase>You can make sure that the author wrote this post by copy-pasting <a href=https://raw.githubusercontent.com/chibby0ne/chibby0ne.github.io/master/posts_signatures/2019-12-15-backing_up_google_authenticator_keys.asc>this signature</a> into <a href=https://keybase.io/verify>this Keybase page</a>.</p></div></div><nav class=post-pagination><a class=newer-posts href=/posts/2020-02-01-ripping_audio_cds_like_its_1995/>Next<br>Mounting/Playing/Ripping audio CDs like it's 1995 (in Arch Linux)</a>
<a class=older-posts href=/posts/2018-08-11-docker_login_password_store/>Previous<br>Using a credential store for DockerHub login</a></nav><div class=post-comment-wrapper><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://www.antoniojgutierrez.com/posts/2019-12-15-backing_up_google_authenticator_keys/",this.page.identifier="/posts/2019-12-15-backing_up_google_authenticator_keys/"};(function(){var e=document,t=e.createElement("script");t.src="https://antoniojgutierrez.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></div></div></div></div><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://www.antoniojgutierrez.com/><div class=nav-title>Murmurations of Neurons</div><div class=nav-subtitle>An exploration of ideas and thoughts on programming, computers, nature and life in general</div></a><div class=nav-link-list><a class="a-block nav-link-item false" href=/about>About me</a>
<a class="a-block nav-link-item active" href=/posts>Archive</a>
<a class="a-block nav-link-item false" href=/categories>Categories</a>
<a class="a-block nav-link-item false" href=/tags>Tags</a>
<a class="a-block nav-link-item false" href=/cv>CV</a>
<a class="a-block nav-link-item false" href=https://github.com/chibby0ne/CTFs>CTFs</a>
<a class="a-block nav-link-item false" href=/index.xml>RSS Feed</a></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Antonio Gutierrez 2015-2021. CC-BY-NC 4.0</div></div><div id=extraContainer class=extra-container><div class=toc-wrapper><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#prerequisites class=nav-prerequisites>Prerequisites</a></li><li><a href=#run-adb-as-root class=nav-run-adb-as-root>Run adb as root</a></li><li><a href=#fetching-the-database class=nav-fetching-the-database>Fetching the database</a></li><li><a href=#opening-the-database class=nav-opening-the-database>Opening the database</a></li></ul></div></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a>
<a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Antonio Gutierrez 2015-2021. CC-BY-NC 4.0</div></div><script src=/js/journal.js></script></body></html>