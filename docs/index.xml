<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Bits and pieces</title><link>https://www.antoniojgutierrez.com/</link><description>Recent content on Bits and pieces</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Antonio Gutierrez 2020. CC-BY-NC 4.0</copyright><lastBuildDate>Fri, 14 May 2021 02:18:25 +0200</lastBuildDate><atom:link href="https://www.antoniojgutierrez.com/index.xml" rel="self" type="application/rss+xml"/><item><title>Short and Long Options with Go flag standard package</title><link>https://www.antoniojgutierrez.com/posts/2021-05-14-short-and-long-options-in-go-flags-pkg/</link><pubDate>Fri, 14 May 2021 02:18:25 +0200</pubDate><guid>https://www.antoniojgutierrez.com/posts/2021-05-14-short-and-long-options-in-go-flags-pkg/</guid><description>Bits and pieces https://www.antoniojgutierrez.com/posts/2021-05-14-short-and-long-options-in-go-flags-pkg/ -&lt;p>Recently I was browsing the awesome
&lt;a href="https://github.com/FiloSottile/age">age&lt;/a> (which I encourage everyone to
look at and use if you haven&amp;rsquo;t already), and noticed something that I had
always mistakenly assumed wasn&amp;rsquo;t possible with the Go standard library.&lt;/p>
&lt;blockquote>
&lt;p>Is it possible to have short &lt;em>and&lt;/em> long options using just the &lt;code>flag&lt;/code> package?&lt;/p>
&lt;/blockquote>
&lt;p>Apparently it is possible!&lt;/p>
&lt;p>To give a little more context, the short options are those that start
with a single dash (&lt;code>-&lt;/code>) and consist of a single letter, e.g: for most
command line argument to set verbose mode you&amp;rsquo;d use: &lt;code>-v&lt;/code>.
In contrast, the long options are those that start with double dash &lt;code>--&lt;/code> and
consist of a word e.g: to use the same example of verbose mode that would be
&lt;code>--verbose&lt;/code>.&lt;/p>
&lt;p>In order to find this out let&amp;rsquo;s first write small program that uses the &lt;code>flag&lt;/code>
package and discover how the invocation of them change the output:&lt;/p>
&lt;p>First let&amp;rsquo;s create a directory where to put the program and initialize the
go.mod:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ mkdir -p ~/go_experiments/using_flag
$ &lt;span style="color:#658b00">cd&lt;/span> !$
$ go mod init github.com/chibby0ne/&lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>basename &lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>&lt;span style="color:#658b00">pwd&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>This creates a directory &lt;code>using_flag&lt;/code> inside a &lt;code>go_experiments&lt;/code>
directory located in your home directory and initializes a go mod with the
organization/user name &lt;code>chibby0ne&lt;/code> (my username) and repository name the same
as the directory name (&lt;code>using_flag&lt;/code>). Of course you can use your Github
username, but since this is just for experimentation it doesn&amp;rsquo;t really matter
the organization/username or module name you choose.&lt;/p>
&lt;ul>
&lt;li>&lt;em>The &lt;code>!$&lt;/code> used in the second line is a shortcut to refer to the last argument of the last command. Pretty neat huh? You can check more about it in the &lt;a href="https://linux.die.net/man/1/bash">man pages of bash looking into history expansion&lt;/a>&lt;/em>&lt;/li>
&lt;/ul>
&lt;p>Now copy the following code in and write it to a &lt;code>main.go&lt;/code> file, and build it
with &lt;code>go build&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">package&lt;/span> main
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> (
&lt;span style="color:#cd5555">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;span style="color:#cd5555">&amp;#34;flag&amp;#34;&lt;/span>
)
&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> &lt;span style="color:#008b45">main&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">var&lt;/span> verbose &lt;span style="color:#00688b;font-weight:bold">bool&lt;/span>
flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;verbose, &lt;span style="color:#cd5555">&amp;#34;verbose&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;verbose output&amp;#34;&lt;/span>)
flag.&lt;span style="color:#008b45">Parse&lt;/span>()
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> verbose {
fmt.&lt;span style="color:#008b45">Println&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;verbose is on&amp;#34;&lt;/span>)
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>This program should write: &lt;code>verbose is on&lt;/code> to stdout whenever the &lt;code>verbose&lt;/code> flag
is set, otherwise it shouldn&amp;rsquo;t print anything.&lt;/p>
&lt;p>Let&amp;rsquo;s see the output with only no flag:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ ./using_flag
$
&lt;/code>&lt;/pre>&lt;/div>&lt;p>No output as expected.&lt;/p>
&lt;p>Let&amp;rsquo;s see the output with only one dash (as usually done):&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ ./using_flag -verbose
verbose is on
$
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now let&amp;rsquo;s see the output with &lt;em>two&lt;/em> dashes:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ ./using_flag --verbose
verbose is on
$
&lt;/code>&lt;/pre>&lt;/div>&lt;p>As you can see the &lt;code>flag&lt;/code> package allows this usage with double dash or long
option format but its usage is not &lt;em>&amp;ldquo;well documented&amp;rdquo;&lt;/em> in the package
documentation.&lt;/p>
&lt;p>Why is this the case?&lt;/p>
&lt;p>Let&amp;rsquo;s dig into what happens when we set a &lt;code>BoolVar&lt;/code> (which is the case for any
XVar where &lt;em>X&lt;/em> is any type). All the source code shown corresponds to &lt;strong>go version
go1.16.4 linux/amd64&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// BoolVar defines a bool flag with specified name, default value, and usage string.
&lt;/span>&lt;span style="color:#228b22">// The argument p points to a bool variable in which to store the value of the flag.
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> &lt;span style="color:#008b45">BoolVar&lt;/span>(p *&lt;span style="color:#00688b;font-weight:bold">bool&lt;/span>, name &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>, value &lt;span style="color:#00688b;font-weight:bold">bool&lt;/span>, usage &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>) {
CommandLine.&lt;span style="color:#008b45">Var&lt;/span>(&lt;span style="color:#008b45">newBoolValue&lt;/span>(value, p), name, usage)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let&amp;rsquo;s decompose the magic out of this one liner:&lt;/p>
&lt;ol>
&lt;li>What does &lt;code>newBoolValue&lt;/code> do?&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// -- bool Value
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> boolValue &lt;span style="color:#00688b;font-weight:bold">bool&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> &lt;span style="color:#008b45">newBoolValue&lt;/span>(val &lt;span style="color:#00688b;font-weight:bold">bool&lt;/span>, p *&lt;span style="color:#00688b;font-weight:bold">bool&lt;/span>) *boolValue {
*p = val
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> (*boolValue)(p)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>newBoolValue&lt;/code> is an unexported (private in other languages terminology)
function that creates a &lt;code>boolValue&lt;/code> which is an type alias for &lt;code>bool&lt;/code>. The pointer to
&lt;code>bool&lt;/code> passed (&lt;code>p&lt;/code> in &lt;code>BoolVar&lt;/code> and in &lt;code>newBoolValue&lt;/code> functions) is assigned to
the default value (&lt;code>value&lt;/code> in &lt;code>BoolVar&lt;/code> function and &lt;code>val&lt;/code> in &lt;code>newBoolValue&lt;/code>
function).
Then the pointer to &lt;code>bool&lt;/code> is casted to a pointer to &lt;code>boolValue&lt;/code> and
returned.&lt;/p>
&lt;p>You might be wondering: &lt;em>Why create this internal &lt;code>boolValue&lt;/code> for simply
storing the &lt;code>bool&lt;/code>?&lt;/em>&lt;/p>
&lt;p>Because &lt;code>bool&lt;/code> needs to be augmented with methods used by the flags package,
such as &lt;code>Get()&lt;/code>, &lt;code>Set()&lt;/code> and &lt;code>String()&lt;/code>, these methods satisfy the interfaces
used through the package which are &lt;code>Getter&lt;/code> and &lt;code>Value&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> Getter &lt;span style="color:#8b008b;font-weight:bold">interface&lt;/span> {
Value
&lt;span style="color:#008b45">Get&lt;/span>() &lt;span style="color:#8b008b;font-weight:bold">interface&lt;/span>{}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> Value &lt;span style="color:#8b008b;font-weight:bold">interface&lt;/span> {
&lt;span style="color:#008b45">String&lt;/span>() &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>
&lt;span style="color:#008b45">Set&lt;/span>(&lt;span style="color:#00688b;font-weight:bold">string&lt;/span>) &lt;span style="color:#00688b;font-weight:bold">error&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>According to documentation: &lt;code>Value&lt;/code> is the interface to the dynamic value
stored in a flag. &lt;code>Getter&lt;/code> is an interface that allows the contents of
&lt;code>Value&lt;/code> to be retrieved.&lt;/p>
&lt;p>You can read more of the &lt;a href="https://golang.org/pkg/flag/#Getter">Getter&lt;/a> and the
&lt;a href="https://golang.org/pkg/flag/#Value">Value&lt;/a> interface in the documentation,
but for now let&amp;rsquo;s continue with our dive.&lt;/p>
&lt;ol start="2">
&lt;li>What is &lt;code>CommandLine&lt;/code> and what does its method &lt;code>Var&lt;/code> do?&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// CommandLine is the default set of command-line flags, parsed from os.Args.
&lt;/span>&lt;span style="color:#228b22">// The top-level functions such as BoolVar, Arg, and so on are wrappers for the
&lt;/span>&lt;span style="color:#228b22">// methods of CommandLine.
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">var&lt;/span> CommandLine = &lt;span style="color:#008b45">NewFlagSet&lt;/span>(os.Args[&lt;span style="color:#b452cd">0&lt;/span>], ExitOnError)
&lt;/code>&lt;/pre>&lt;/div>&lt;p>As it&amp;rsquo;s very well described in the godoc, &lt;code>CommandLine&lt;/code> is the default flag
set of command line flags for the given executable, (The name used to invoke
the program is always given by &lt;code>os.Args[0]&lt;/code>)&lt;/p>
&lt;p>And the &lt;code>Var&lt;/code> method:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// Var defines a flag with the specified name and usage string. The type and
&lt;/span>&lt;span style="color:#228b22">// value of the flag are represented by the first argument, of type Value, which
&lt;/span>&lt;span style="color:#228b22">// typically holds a user-defined implementation of Value. For instance, the
&lt;/span>&lt;span style="color:#228b22">// caller could create a flag that turns a comma-separated string into a slice
&lt;/span>&lt;span style="color:#228b22">// of strings by giving the slice the methods of Value; in particular, Set would
&lt;/span>&lt;span style="color:#228b22">// decompose the comma-separated string into the slice.
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> (f *FlagSet) &lt;span style="color:#008b45">Var&lt;/span>(value Value, name &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>, usage &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>) {
&lt;span style="color:#228b22">// Remember the default value as a string; it won&amp;#39;t change.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> flag := &amp;amp;Flag{name, usage, value, value.&lt;span style="color:#008b45">String&lt;/span>()}
_, alreadythere := f.formal[name]
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> alreadythere {
&lt;span style="color:#8b008b;font-weight:bold">var&lt;/span> msg &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> f.name == &lt;span style="color:#cd5555">&amp;#34;&amp;#34;&lt;/span> {
msg = fmt.&lt;span style="color:#008b45">Sprintf&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;flag redefined: %s&amp;#34;&lt;/span>, name)
} &lt;span style="color:#8b008b;font-weight:bold">else&lt;/span> {
msg = fmt.&lt;span style="color:#008b45">Sprintf&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;%s flag redefined: %s&amp;#34;&lt;/span>, f.name, name)
}
fmt.&lt;span style="color:#008b45">Fprintln&lt;/span>(f.&lt;span style="color:#008b45">Output&lt;/span>(), msg)
&lt;span style="color:#658b00">panic&lt;/span>(msg) &lt;span style="color:#228b22">// Happens only if flags are declared with identical names
&lt;/span>&lt;span style="color:#228b22">&lt;/span> }
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> f.formal == &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span> {
f.formal = &lt;span style="color:#658b00">make&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">map&lt;/span>[&lt;span style="color:#00688b;font-weight:bold">string&lt;/span>]*Flag)
}
f.formal[name] = flag
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>There&amp;rsquo;s a lot going on in there but let&amp;rsquo;s go step by step.&lt;/p>
&lt;p>The godoc mentions that &lt;code>Var&lt;/code>'s first argument usually holds a user-defined
implementation of &lt;code>Value&lt;/code> and it could have a custom &lt;code>Set()&lt;/code> method that
converts its arguments into a slice or some other type aggregate type. In our
case that&amp;rsquo;s not the case but since it&amp;rsquo;s part of this method documentation
which is shown in the godoc it&amp;rsquo;s good to be as general as possible.&lt;/p>
&lt;p>Looking at the code we see that:&lt;/p>
&lt;ol>
&lt;li>A &lt;code>Flag&lt;/code> is created.&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">flag := &amp;amp;Flag{name, usage, value, value.&lt;span style="color:#008b45">String&lt;/span>()}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>And a &lt;code>Flag&lt;/code> is:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// A Flag represents the state of a flag.
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> Flag &lt;span style="color:#8b008b;font-weight:bold">struct&lt;/span> {
Name &lt;span style="color:#00688b;font-weight:bold">string&lt;/span> &lt;span style="color:#228b22">// name as it appears on command line
&lt;/span>&lt;span style="color:#228b22">&lt;/span> Usage &lt;span style="color:#00688b;font-weight:bold">string&lt;/span> &lt;span style="color:#228b22">// help message
&lt;/span>&lt;span style="color:#228b22">&lt;/span> Value Value &lt;span style="color:#228b22">// value as set
&lt;/span>&lt;span style="color:#228b22">&lt;/span> DefValue &lt;span style="color:#00688b;font-weight:bold">string&lt;/span> &lt;span style="color:#228b22">// default value (as text); for usage message
&lt;/span>&lt;span style="color:#228b22">&lt;/span>}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>It&amp;rsquo;s simply a struct that aggregates the name, usage, value and default value.&lt;/p>
&lt;ol start="2">
&lt;li>A check is made on a unexported map (&lt;code>f.formal&lt;/code>) which is part of the
&lt;code>FlagSet&lt;/code> (in this case of &lt;code>CommandLine&lt;/code>).&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">_, alreadythere := f.formal[name]
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The &lt;code>FlagSet&lt;/code> structure has several unexported fields of which the &lt;code>Var&lt;/code>
function uses &lt;code>name&lt;/code> (a string) and &lt;code>formal&lt;/code> (a map of type &lt;code>[string]*Flag&lt;/code>)&lt;/p>
&lt;p>As can be seen here:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// A FlagSet represents a set of defined flags. The zero value of a FlagSet
&lt;/span>&lt;span style="color:#228b22">// has no name and has ContinueOnError error handling.
&lt;/span>&lt;span style="color:#228b22">//
&lt;/span>&lt;span style="color:#228b22">// Flag names must be unique within a FlagSet. An attempt to define a flag whose
&lt;/span>&lt;span style="color:#228b22">// name is already in use will cause a panic.
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> FlagSet &lt;span style="color:#8b008b;font-weight:bold">struct&lt;/span> {
&lt;span style="color:#228b22">// Usage is the function called when an error occurs while parsing flags.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#228b22">// The field is a function (not a method) that may be changed to point to
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#228b22">// a custom error handler. What happens after Usage is called depends
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#228b22">// on the ErrorHandling setting; for the command line, this defaults
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#228b22">// to ExitOnError, which exits the program after calling Usage.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> Usage &lt;span style="color:#8b008b;font-weight:bold">func&lt;/span>()
name &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>
parsed &lt;span style="color:#00688b;font-weight:bold">bool&lt;/span>
actual &lt;span style="color:#8b008b;font-weight:bold">map&lt;/span>[&lt;span style="color:#00688b;font-weight:bold">string&lt;/span>]*Flag
formal &lt;span style="color:#8b008b;font-weight:bold">map&lt;/span>[&lt;span style="color:#00688b;font-weight:bold">string&lt;/span>]*Flag
args []&lt;span style="color:#00688b;font-weight:bold">string&lt;/span> &lt;span style="color:#228b22">// arguments after flags
&lt;/span>&lt;span style="color:#228b22">&lt;/span> errorHandling ErrorHandling
output io.Writer &lt;span style="color:#228b22">// nil means stderr; use Output() accessor
&lt;/span>&lt;span style="color:#228b22">&lt;/span>}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The check is made as can be seen to see if the flag is redefined, returning a
different error depending on whether the flagSet has an empty name or not.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go"> &lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> alreadythere {
&lt;span style="color:#8b008b;font-weight:bold">var&lt;/span> msg &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> f.name == &lt;span style="color:#cd5555">&amp;#34;&amp;#34;&lt;/span> {
msg = fmt.&lt;span style="color:#008b45">Sprintf&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;flag redefined: %s&amp;#34;&lt;/span>, name)
} &lt;span style="color:#8b008b;font-weight:bold">else&lt;/span> {
msg = fmt.&lt;span style="color:#008b45">Sprintf&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;%s flag redefined: %s&amp;#34;&lt;/span>, f.name, name)
}
fmt.&lt;span style="color:#008b45">Fprintln&lt;/span>(f.&lt;span style="color:#008b45">Output&lt;/span>(), msg)
&lt;span style="color:#658b00">panic&lt;/span>(msg) &lt;span style="color:#228b22">// Happens only if flags are declared with identical names
&lt;/span>&lt;span style="color:#228b22">&lt;/span> }
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>If the map is not yet created (nil) then a maps is created.&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go"> &lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> f.formal == &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span> {
f.formal = &lt;span style="color:#658b00">make&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">map&lt;/span>[&lt;span style="color:#00688b;font-weight:bold">string&lt;/span>]*Flag)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>Add an entry in the map with the name of the flag as key and the pointer to
the flag itself as value.&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">f.formal[name] = flag
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now the next piece of the puzzle comes in the next line of our program:
&lt;code>flag.Parse()&lt;/code>.&lt;/p>
&lt;p>Diving deep again:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// Parse parses the command-line flags from os.Args[1:]. Must be called
&lt;/span>&lt;span style="color:#228b22">// after all flags are defined and before flags are accessed by the program.
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> &lt;span style="color:#008b45">Parse&lt;/span>() {
&lt;span style="color:#228b22">// Ignore errors; CommandLine is set for ExitOnError.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> CommandLine.&lt;span style="color:#008b45">Parse&lt;/span>(os.Args[&lt;span style="color:#b452cd">1&lt;/span>:])
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>We can see that it calls the &lt;code>Parse&lt;/code> method of the &lt;code>*FlagSet&lt;/code> &lt;code>CommandLine&lt;/code>
with all the arguments passed to the executable.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// Parse parses flag definitions from the argument list, which should not
&lt;/span>&lt;span style="color:#228b22">// include the command name. Must be called after all flags in the FlagSet
&lt;/span>&lt;span style="color:#228b22">// are defined and before flags are accessed by the program.
&lt;/span>&lt;span style="color:#228b22">// The return value will be ErrHelp if -help or -h were set but not defined.
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> (f *FlagSet) &lt;span style="color:#008b45">Parse&lt;/span>(arguments []&lt;span style="color:#00688b;font-weight:bold">string&lt;/span>) &lt;span style="color:#00688b;font-weight:bold">error&lt;/span> {
f.parsed = &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>
f.args = arguments
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> {
seen, err := f.&lt;span style="color:#008b45">parseOne&lt;/span>()
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> seen {
&lt;span style="color:#8b008b;font-weight:bold">continue&lt;/span>
}
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> err == &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">break&lt;/span>
}
&lt;span style="color:#8b008b;font-weight:bold">switch&lt;/span> f.errorHandling {
&lt;span style="color:#8b008b;font-weight:bold">case&lt;/span> ContinueOnError:
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> err
&lt;span style="color:#8b008b;font-weight:bold">case&lt;/span> ExitOnError:
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> err == ErrHelp {
os.&lt;span style="color:#008b45">Exit&lt;/span>(&lt;span style="color:#b452cd">0&lt;/span>)
}
os.&lt;span style="color:#008b45">Exit&lt;/span>(&lt;span style="color:#b452cd">2&lt;/span>)
&lt;span style="color:#8b008b;font-weight:bold">case&lt;/span> PanicOnError:
&lt;span style="color:#658b00">panic&lt;/span>(err)
}
}
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>We can summarize this function as parsing each flag until all flags are parsed
and either errors/panics in case of an error or returns nil in case
there wasn&amp;rsquo;t any.&lt;/p>
&lt;p>More specifically the loop ends if &lt;code>err&lt;/code> returned from &lt;code>f.parseOne()&lt;/code> is
nil, and continues if the &lt;code>seen&lt;/code> returned by &lt;code>f.parseOne()&lt;/code> is &lt;code>true&lt;/code>.&lt;/p>
&lt;p>Do note, that even though arguments passed are being assigned to &lt;code>f.args&lt;/code>, the
for loop doesn&amp;rsquo;t explicitly iterate over them, instead it an infinite loops,
and &lt;code>f.parseOne()&lt;/code> handles parsing and shifting the arguments passed.&lt;/p>
&lt;p>As we can see the real key to understating the &lt;code>Parse&lt;/code> method is &lt;code>f.parseOne()&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// parseOne parses one flag. It reports whether a flag was seen.
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> (f *FlagSet) &lt;span style="color:#008b45">parseOne&lt;/span>() (&lt;span style="color:#00688b;font-weight:bold">bool&lt;/span>, &lt;span style="color:#00688b;font-weight:bold">error&lt;/span>) {
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> &lt;span style="color:#658b00">len&lt;/span>(f.args) == &lt;span style="color:#b452cd">0&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span>
}
s := f.args[&lt;span style="color:#b452cd">0&lt;/span>]
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> &lt;span style="color:#658b00">len&lt;/span>(s) &amp;lt; &lt;span style="color:#b452cd">2&lt;/span> || s[&lt;span style="color:#b452cd">0&lt;/span>] != &lt;span style="color:#cd5555">&amp;#39;-&amp;#39;&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span>
}
numMinuses := &lt;span style="color:#b452cd">1&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> s[&lt;span style="color:#b452cd">1&lt;/span>] == &lt;span style="color:#cd5555">&amp;#39;-&amp;#39;&lt;/span> {
numMinuses++
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> &lt;span style="color:#658b00">len&lt;/span>(s) == &lt;span style="color:#b452cd">2&lt;/span> { &lt;span style="color:#228b22">// &amp;#34;--&amp;#34; terminates the flags
&lt;/span>&lt;span style="color:#228b22">&lt;/span> f.args = f.args[&lt;span style="color:#b452cd">1&lt;/span>:]
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span>
}
}
name := s[numMinuses:]
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> &lt;span style="color:#658b00">len&lt;/span>(name) == &lt;span style="color:#b452cd">0&lt;/span> || name[&lt;span style="color:#b452cd">0&lt;/span>] == &lt;span style="color:#cd5555">&amp;#39;-&amp;#39;&lt;/span> || name[&lt;span style="color:#b452cd">0&lt;/span>] == &lt;span style="color:#cd5555">&amp;#39;=&amp;#39;&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, f.&lt;span style="color:#008b45">failf&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;bad flag syntax: %s&amp;#34;&lt;/span>, s)
}
&lt;span style="color:#228b22">// it&amp;#39;s a flag. does it have an argument?
&lt;/span>&lt;span style="color:#228b22">&lt;/span> f.args = f.args[&lt;span style="color:#b452cd">1&lt;/span>:]
hasValue := &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>
value := &lt;span style="color:#cd5555">&amp;#34;&amp;#34;&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> i := &lt;span style="color:#b452cd">1&lt;/span>; i &amp;lt; &lt;span style="color:#658b00">len&lt;/span>(name); i++ { &lt;span style="color:#228b22">// equals cannot be first
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> name[i] == &lt;span style="color:#cd5555">&amp;#39;=&amp;#39;&lt;/span> {
value = name[i+&lt;span style="color:#b452cd">1&lt;/span>:]
hasValue = &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>
name = name[&lt;span style="color:#b452cd">0&lt;/span>:i]
&lt;span style="color:#8b008b;font-weight:bold">break&lt;/span>
}
}
m := f.formal
flag, alreadythere := m[name] &lt;span style="color:#228b22">// BUG
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> !alreadythere {
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> name == &lt;span style="color:#cd5555">&amp;#34;help&amp;#34;&lt;/span> || name == &lt;span style="color:#cd5555">&amp;#34;h&amp;#34;&lt;/span> { &lt;span style="color:#228b22">// special case for nice help message.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> f.&lt;span style="color:#008b45">usage&lt;/span>()
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, ErrHelp
}
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, f.&lt;span style="color:#008b45">failf&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;flag provided but not defined: -%s&amp;#34;&lt;/span>, name)
}
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> fv, ok := flag.Value.(boolFlag); ok &amp;amp;&amp;amp; fv.&lt;span style="color:#008b45">IsBoolFlag&lt;/span>() { &lt;span style="color:#228b22">// special case: doesn&amp;#39;t need an arg
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> hasValue {
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> err := fv.&lt;span style="color:#008b45">Set&lt;/span>(value); err != &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, f.&lt;span style="color:#008b45">failf&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;invalid boolean value %q for -%s: %v&amp;#34;&lt;/span>, value, name, err)
}
} &lt;span style="color:#8b008b;font-weight:bold">else&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> err := fv.&lt;span style="color:#008b45">Set&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;true&amp;#34;&lt;/span>); err != &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, f.&lt;span style="color:#008b45">failf&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;invalid boolean flag %s: %v&amp;#34;&lt;/span>, name, err)
}
}
} &lt;span style="color:#8b008b;font-weight:bold">else&lt;/span> {
&lt;span style="color:#228b22">// It must have a value, which might be the next argument.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> !hasValue &amp;amp;&amp;amp; &lt;span style="color:#658b00">len&lt;/span>(f.args) &amp;gt; &lt;span style="color:#b452cd">0&lt;/span> {
&lt;span style="color:#228b22">// value is the next arg
&lt;/span>&lt;span style="color:#228b22">&lt;/span> hasValue = &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>
value, f.args = f.args[&lt;span style="color:#b452cd">0&lt;/span>], f.args[&lt;span style="color:#b452cd">1&lt;/span>:]
}
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> !hasValue {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, f.&lt;span style="color:#008b45">failf&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;flag needs an argument: -%s&amp;#34;&lt;/span>, name)
}
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> err := flag.Value.&lt;span style="color:#008b45">Set&lt;/span>(value); err != &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, f.&lt;span style="color:#008b45">failf&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;invalid value %q for flag -%s: %v&amp;#34;&lt;/span>, value, name, err)
}
}
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> f.actual == &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span> {
f.actual = &lt;span style="color:#658b00">make&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">map&lt;/span>[&lt;span style="color:#00688b;font-weight:bold">string&lt;/span>]*Flag)
}
f.actual[name] = flag
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Whoa! That&amp;rsquo;s a lot to unpack. Fortunately we don&amp;rsquo;t need to analyze the whole
function to get to the single and double dashes logic, but let&amp;rsquo;s take it
piecemeal:&lt;/p>
&lt;ol>
&lt;li>Check if there are no arguments:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go"> &lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> &lt;span style="color:#658b00">len&lt;/span>(f.args) == &lt;span style="color:#b452cd">0&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>So if there are no arguments it simply ends parsing.&lt;/p>
&lt;ol start="2">
&lt;li>Getting the first command line argument (the actual option/flag name)&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">s := f.args[&lt;span style="color:#b452cd">0&lt;/span>]
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Since &lt;code>f.args&lt;/code> was all the command line arguments with whom the executable was
called (this is simply assigning to &lt;code>s&lt;/code> the first command line argument).
Later we will see that the &lt;code>f.args&lt;/code> slice gets updated in this function, so
that it we advance the command line arguments seen.&lt;/p>
&lt;p>In our example program, this would make:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">s := &lt;span style="color:#cd5555">&amp;#34;-verbose&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>&lt;strong>The actual explanation of why the short and long options work&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go"> &lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> &lt;span style="color:#658b00">len&lt;/span>(s) &amp;lt; &lt;span style="color:#b452cd">2&lt;/span> || s[&lt;span style="color:#b452cd">0&lt;/span>] != &lt;span style="color:#cd5555">&amp;#39;-&amp;#39;&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span>
}
numMinuses := &lt;span style="color:#b452cd">1&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> s[&lt;span style="color:#b452cd">1&lt;/span>] == &lt;span style="color:#cd5555">&amp;#39;-&amp;#39;&lt;/span> {
numMinuses++
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> &lt;span style="color:#658b00">len&lt;/span>(s) == &lt;span style="color:#b452cd">2&lt;/span> { &lt;span style="color:#228b22">// &amp;#34;--&amp;#34; terminates the flags
&lt;/span>&lt;span style="color:#228b22">&lt;/span> f.args = f.args[&lt;span style="color:#b452cd">1&lt;/span>:]
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span>
}
}
name := s[numMinuses:]
&lt;/code>&lt;/pre>&lt;/div>&lt;p>To explain this part let&amp;rsquo;s continue with the flag in our example program &lt;code>s&lt;/code>,
but let&amp;rsquo;s assume we have invoked it with 2 dashes:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">s := &lt;span style="color:#cd5555">&amp;#34;--verbose&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The first if returns if the length of &lt;code>s&lt;/code> is 1 or not if the first rune
(character) is not a dash. None of these is our case.&lt;/p>
&lt;p>Since we don&amp;rsquo;t enter the body of the if statement the first rune &lt;em>must&lt;/em> be a
dash, or minus as it is called in the code, then the &lt;code>numMinuses&lt;/code> is set to 1.&lt;/p>
&lt;p>The second if checks whether the second character of the string is a dash &lt;code>-&lt;/code>
and if it is it increments the &lt;code>numMinuses&lt;/code> to 2. If it isn&amp;rsquo;t then the body of
the if is skipped.&lt;/p>
&lt;p>Then checks if s consist of just that: two dashes (&lt;code>--&lt;/code>), since the two dashes
is the flags terminator as we can see the function returns also false, and nil
as before.&lt;/p>
&lt;p>After this the &lt;code>name := s[numMinuses:]&lt;/code> slices the string so as to only trim
the dashes and leave only the name of the flag.&lt;/p>
&lt;p>i.e: &lt;code>name := &amp;quot;verbose&amp;quot;&lt;/code>&lt;/p>
&lt;p>And this is the reason why the standard library &lt;code>flag&lt;/code> package works for both
single or double dashes.&lt;/p>
&lt;p>Now if you&amp;rsquo;ve made it this far &lt;em>and&lt;/em> you&amp;rsquo;re also learning this was also news
to you, then I&amp;rsquo;m afraid this wasn&amp;rsquo;t a big reveal and is actually expected.&lt;/p>
&lt;p>&lt;em>&lt;strong>This is actually documented behavior&lt;/strong>&lt;/em>, the thing is that is not actually &lt;strong>well
documented&lt;/strong>. From the
&lt;a href="https://golang.org/pkg/flag/#hdr-Command_line_flag_syntax">docs&lt;/a>, we can see
that it shows 3 examples with a single dash but the text below mentions that
double dashes are also possible.&lt;/p>
&lt;p>&lt;img src="../../img/screenshot_flag_pkg_go.png" alt="screenshot_flag_pkg_go">&lt;/p>
&lt;p>So, yeah, RTFM am I right?&lt;/p>
&lt;p>OK, great. But this still doesn&amp;rsquo;t answer the question: &lt;strong>Is it possible to
have short/long options using just flag package?&lt;/strong>&lt;/p>
&lt;p>Well with this newfound knowledge of how flags are made and kept in the
&lt;code>*FlagSet&lt;/code> this should be now a bit more straightforward, but let&amp;rsquo;s check how it
is done in
&lt;a href="https://github.com/FiloSottile/age/blob/master/cmd/age/age.go#L97-L102">age&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go"> flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;decryptFlag, &lt;span style="color:#cd5555">&amp;#34;d&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;decrypt the input&amp;#34;&lt;/span>)
flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;decryptFlag, &lt;span style="color:#cd5555">&amp;#34;decrypt&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;decrypt the input&amp;#34;&lt;/span>)
flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;encryptFlag, &lt;span style="color:#cd5555">&amp;#34;e&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;encrypt the input&amp;#34;&lt;/span>)
flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;encryptFlag, &lt;span style="color:#cd5555">&amp;#34;encrypt&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;encrypt the input&amp;#34;&lt;/span>)
flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;passFlag, &lt;span style="color:#cd5555">&amp;#34;p&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;use a passphrase&amp;#34;&lt;/span>)
flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;passFlag, &lt;span style="color:#cd5555">&amp;#34;passphrase&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;use a passphrase&amp;#34;&lt;/span>)
&lt;/code>&lt;/pre>&lt;/div>&lt;p>As can be seen all that it&amp;rsquo;s needed is to assign to the same variable two
flags: one with a single letter and one with a word. Of course this doesn&amp;rsquo;t
prevent anyone from using the single dash with the word form or the double
dash with the single letter, but if the ergonomics and restricting the usages
are really important, you can always modify &lt;code>flag.Usage&lt;/code> so that these two
cases are documented, &lt;a href="https://github.com/FiloSottile/age/blob/master/cmd/age/age.go#L35">as it is done with
&lt;code>age&lt;/code>&lt;/a>.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">const&lt;/span> usage = &lt;span style="color:#a61717;background-color:#e3d2d2">`&lt;/span>Usage:
age [--encrypt] (-r RECIPIENT | -R PATH)... [--armor] [-o OUTPUT] [INPUT]
age [--encrypt] --passphrase [--armor] [-o OUTPUT] [INPUT]
age --decrypt [-i PATH]... [-o OUTPUT] [INPUT]
Options:
-e, --encrypt Encrypt the input to the output. Default &lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> omitted.
-d, --decrypt Decrypt the input to the output.
-o, --output OUTPUT Write the result to the file at path OUTPUT.
-a, --armor Encrypt to a PEM encoded format.
-p, --passphrase Encrypt with a passphrase.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>We can test it in our tiny example program by adding an extra line with &lt;code>&amp;quot;v&amp;quot;&lt;/code>
as flag name such that it looks like this:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">package&lt;/span> main
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> (
&lt;span style="color:#cd5555">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;span style="color:#cd5555">&amp;#34;flag&amp;#34;&lt;/span>
)
&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> &lt;span style="color:#008b45">main&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">var&lt;/span> verbose &lt;span style="color:#00688b;font-weight:bold">bool&lt;/span>
flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;verbose, &lt;span style="color:#cd5555">&amp;#34;verbose&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;verbose output&amp;#34;&lt;/span>)
flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;verbose, &lt;span style="color:#cd5555">&amp;#34;v&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;verbose output&amp;#34;&lt;/span>)
flag.&lt;span style="color:#008b45">Parse&lt;/span>()
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> verbose {
fmt.&lt;span style="color:#008b45">Println&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;verbose is on&amp;#34;&lt;/span>)
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Don&amp;rsquo;t forget to build it after modifying it.&lt;/p>
&lt;p>Invoking it with &lt;code>-v&lt;/code>, &lt;code>--v&lt;/code> and of course the other two cases works as well:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ ./using_flag -v
verbose is on
$ ./using_flag --verbose
verbose is on
$ ./using_flag --v
verbose is on
$ ./using_flag -verbose
verbose is on
&lt;/code>&lt;/pre>&lt;/div>&lt;p>And of course invoking it with three (or more dashes) dashes results in a
error:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ ./using_flag ---verbose
bad flag syntax: ---verbose
Usage of ./using_flag:
-v verbose output
-verbose
verbose output
$
&lt;/code>&lt;/pre>&lt;/div>&lt;p>For completion&amp;rsquo;s sake we&amp;rsquo;ll modify the &lt;code>flag.Usage&lt;/code> so that we have a neater
error when we either print help or have an error parsing flags:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">package&lt;/span> main
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> (
&lt;span style="color:#cd5555">&amp;#34;flag&amp;#34;&lt;/span>
&lt;span style="color:#cd5555">&amp;#34;fmt&amp;#34;&lt;/span>
)
&lt;span style="color:#8b008b;font-weight:bold">const&lt;/span> usage = &lt;span style="color:#cd5555">`Usage of using_flag:
&lt;/span>&lt;span style="color:#cd5555"> -v, --verbose verbose output
&lt;/span>&lt;span style="color:#cd5555"> -h, --help prints help information
&lt;/span>&lt;span style="color:#cd5555">`&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> &lt;span style="color:#008b45">main&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">var&lt;/span> verbose &lt;span style="color:#00688b;font-weight:bold">bool&lt;/span>
flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;verbose, &lt;span style="color:#cd5555">&amp;#34;verbose&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;verbose output&amp;#34;&lt;/span>)
flag.&lt;span style="color:#008b45">BoolVar&lt;/span>(&amp;amp;verbose, &lt;span style="color:#cd5555">&amp;#34;v&amp;#34;&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>, &lt;span style="color:#cd5555">&amp;#34;verbose output&amp;#34;&lt;/span>)
flag.Usage = &lt;span style="color:#8b008b;font-weight:bold">func&lt;/span>() { fmt.&lt;span style="color:#008b45">Print&lt;/span>(usage) }
flag.&lt;span style="color:#008b45">Parse&lt;/span>()
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> verbose {
fmt.&lt;span style="color:#008b45">Println&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;verbose is on&amp;#34;&lt;/span>)
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>which outputs:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ ./using_flag ---verbose
bad flag syntax: ---verbose
Usage of using_flag:
-v, --verbose verbose output
-h, --help prints &lt;span style="color:#658b00">help&lt;/span> information
$
&lt;/code>&lt;/pre>&lt;/div>&lt;p>I think the main reason people assume this isn&amp;rsquo;t possible is because the
flag documentation doesn&amp;rsquo;t &lt;em>&lt;strong>show&lt;/strong>&lt;/em> that the options could be passed with
&lt;em>single or double dash&lt;/em>. The fact that by far most people that want a CLI that
handles flags cleaning use &lt;a href="https://www.github.com/spf13/cobra">spf13/cobra&lt;/a>
doesn&amp;rsquo;t help either. Also it doesn&amp;rsquo;t help that is a high quality package with
nice ergonomics.&lt;/p>
&lt;p>But as you can see, it&amp;rsquo;s not essential to use in order to have regular
Unix-style command line options.&lt;/p>
&lt;p>That&amp;rsquo;s all folks. Happy hacking!&lt;/p>
- https://www.antoniojgutierrez.com/posts/2021-05-14-short-and-long-options-in-go-flags-pkg/ - Antonio Gutierrez 2020. CC-BY-NC 4.0</description></item><item><title>Things to backup before doing a factory reset of an Android Phone</title><link>https://www.antoniojgutierrez.com/posts/2021-01-31-steps_todo_before_factory_reset_android/</link><pubDate>Sun, 31 Jan 2021 23:46:55 +0100</pubDate><guid>https://www.antoniojgutierrez.com/posts/2021-01-31-steps_todo_before_factory_reset_android/</guid><description>Bits and pieces https://www.antoniojgutierrez.com/posts/2021-01-31-steps_todo_before_factory_reset_android/ -&lt;p>There&amp;rsquo;s always something that I miss whenever I do a factory reset of my
personal phone, whether it&amp;rsquo;s the signal backup (which is now enabled by
the usage of a PIN), or some new 2FA code. This post (as many of them are)
are mental (and written) notes for future me to remember.&lt;/p>
&lt;h2 id="signal-backup">Signal backup&lt;/h2>
&lt;p>Signal now allows you to backup chats and media into a local directory in the
phone. When a Signal is reinstalled it prompts you for restoring from a local
backup. Remember to write down the backup code otherwise you will not be able
to restore.&lt;/p>
&lt;p>To enable backup of the Chats you must go to &lt;code>Settings -&amp;gt; Chats -&amp;gt; Chat backups&lt;/code> and click the &lt;code>Turn On&lt;/code> button and write down the backup code.&lt;/p>
&lt;h2 id="whatsapp-backup">WhatsApp backup&lt;/h2>
&lt;p>WhatsApp backups up the conversations to Google Drive by default, but does so
on a weekly basis, therefore in order to not miss out on potentially 6 days of
messages, you should manually trigger a backup.&lt;/p>
&lt;p>In order to trigger one, you must go to &lt;code>Settings -&amp;gt; Chats -&amp;gt; Chat backup -&amp;gt; Back up&lt;/code>&lt;/p>
&lt;h2 id="browser-profile-sync">Browser profile sync&lt;/h2>
&lt;p>For Firefox, Go to &lt;code>Settings -&amp;gt; YOUR_ACCOUNT -&amp;gt; Sync Now&lt;/code>
For Chrome, there&amp;rsquo;s no a manual sync now button that I could tell but you
could disable and enable sync and that should trigger at least a check.&lt;/p>
&lt;h2 id="2fa-authentication-code-backups">2FA Authentication code backups&lt;/h2>
&lt;p>If you must do one backup &lt;strong>this is the one you must do&lt;/strong>; you&amp;rsquo;ll be in a
world of pain when you can&amp;rsquo;t access your accounts due to missing 2FA.
Fortunately there are several ways on how to backup these now for each one of
the famous apps like Google Authenticator, Authy, and others.&lt;/p>
&lt;h2 id="important-notes">Important notes&lt;/h2>
&lt;ul>
&lt;li>Unlocking &lt;em>&lt;strong>and&lt;/strong>&lt;/em> locking the bootloader resets the phone.&lt;/li>
&lt;li>Very difficult to get rid of Google Play services completely if choosing the
red pill and going for a custom ROM.&lt;/li>
&lt;/ul>
&lt;p>As you can see most everything is backed up by default to the cloud either
associated to an Gmail account or the apps themselves maintain state in the
cloud, so that in both cases a simple sign in would restore your profile to
its last state.&lt;/p>
&lt;p>Hooray for the cloud?!&lt;/p>
- https://www.antoniojgutierrez.com/posts/2021-01-31-steps_todo_before_factory_reset_android/ - Antonio Gutierrez 2020. CC-BY-NC 4.0</description></item><item><title>Notes from Lex Fridman and Chris Lattner interview Part 2 (Lex Fridman Podcast)</title><link>https://www.antoniojgutierrez.com/posts/2020-09-14-notes_on_lex_fridman_chris_lattner_interview_part2/</link><pubDate>Mon, 14 Sep 2020 00:12:04 +0200</pubDate><guid>https://www.antoniojgutierrez.com/posts/2020-09-14-notes_on_lex_fridman_chris_lattner_interview_part2/</guid><description>Bits and pieces https://www.antoniojgutierrez.com/posts/2020-09-14-notes_on_lex_fridman_chris_lattner_interview_part2/ -&lt;p>After watching the 2 hour+ interview of Chris Lattner in the Lex Fridman
podcast I just knew I &lt;em>had&lt;/em> to write down some of the gems I heard from Chris
Lattner.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;em>&lt;strong>“Turns out if you ask a lot of dumb questions, you learn pretty quickly”&lt;/strong>&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;em>&lt;strong>“In a way, types are like assertions which are checked at compile time”&lt;/strong>&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;em>&lt;strong>“Just making a hello world, won&amp;rsquo;t get you get used to the language. Your
mind needs time and practice. It&amp;rsquo;s the same as if you change diet, you need
time for your metabolism to adapt”&lt;/strong>&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;em>&lt;strong>“What I mean by messed up: very rarely used for good, often used for bugs”&lt;/strong>&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;em>&lt;strong>“Being first principles where you&amp;rsquo;re coming from and what you&amp;rsquo;re trying to
achieve”&lt;/strong>&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;em>&lt;strong>“Fun things about learning programming languages: when you start doing
them, you start learning new things. You have a new way of doing things and
you&amp;rsquo;re forced to do them, and that forces you to explore. That puts you in
learning mode and your mind kind of opens a little bit. And you start seeing
things differently even the old things”&lt;/strong>&lt;/em>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>These are just some of the few nuggets of wisdoms and insights that I stuck
with me after watching it. These long form conversations from Lex Fridman, are
an awesome medium through which I learn form other people and I find it
particularly engrossing since it allows more nuance in the dialogue.&lt;/p>
&lt;p>I 1000% recommend &lt;a href="https://www.youtube.com/watch?v=nWTvXbQHwWs">this episode&lt;/a>
and the whole podcast itself, and will probably write down some more notes of
future episodes.&lt;/p>
- https://www.antoniojgutierrez.com/posts/2020-09-14-notes_on_lex_fridman_chris_lattner_interview_part2/ - Antonio Gutierrez 2020. CC-BY-NC 4.0</description></item><item><title>Fixing Firefox screen tearing while scrolling / video playback</title><link>https://www.antoniojgutierrez.com/posts/2020-05-04-firefox_screen_tearing_while_scrolling/</link><pubDate>Mon, 04 May 2020 00:00:00 +0000</pubDate><guid>https://www.antoniojgutierrez.com/posts/2020-05-04-firefox_screen_tearing_while_scrolling/</guid><description>Bits and pieces https://www.antoniojgutierrez.com/posts/2020-05-04-firefox_screen_tearing_while_scrolling/ -&lt;p>For a while now I&amp;rsquo;ve noticed screen tearing while scrolling on Wikipedia or on
YouTube videos whenever there&amp;rsquo;s sudden movement.&lt;/p>
&lt;p>Today I decided to do something about it, and considering I hadn&amp;rsquo;t touch the
Xorg conf files &amp;ldquo;generated&amp;rdquo; by &lt;code>nvidia-xconfig&lt;/code> in more than 4 years, I was
optimistic that it would be some configuration issue that would have been
automatically resolved by now with newer drivers and OpenGL versions.
Furthermore as the quotes on generated suggest, they weren&amp;rsquo;t pristine
generated Xorg conf files since I had tinkered with them
quite a bit in the past when I was running two Nvidia cards on Arch which I
mentioned in passing in a &lt;a href="https://www.antoniojgutierrez.com/2017/08/20/changing_xorg_conf.html">previous
post&lt;/a>&lt;/p>
&lt;p>So the first thing I did was generate a new Xorg conf, using the command:&lt;/p>
&lt;pre>&lt;code>$ nvidia-xconfig
&lt;/code>&lt;/pre>&lt;p>Which graciously backups the previous config and generates a new one in its stead.&lt;/p>
&lt;p>Having done that I rebooted the computer, opened Firefox and scrolled some
long articles in Wikipedia (like the one for the current &lt;a href="https://en.wikipedia.org/wiki/COVID-19_pandemic">Covid-19
Pandemic&lt;/a>) but the tearing
was still there.&lt;/p>
&lt;p>So I searched the web and found &lt;a href="https://www.reddit.com/r/linuxmint/comments/9pb5ur/screen_tearing_while_scrolling/">this post on
reddit&lt;/a>
which basically describes exactly what was happening to me.&lt;/p>
&lt;p>In it there are basically two solutions provided by the community:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Force GPU Acceleration on Firefox&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Force Full Composition Pipeline of the Nvidia card.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>The first one was self explanatory and the simplest, besides if you have the
hardware you would want to use it whenever and wherever you can, specially in
a desktop environment, where you&amp;rsquo;re not restricted by power consumption from a
battery.&lt;/p>
&lt;p>As for the second option, from the comments and after looking into the good
ole trusty &lt;a href="https://wiki.archlinux.org/index.php/NVIDIA/Troubleshooting#Avoid_screen_tearing">Arch Wiki for screen tearing on
nvidia&lt;/a>,
it seems that while this &lt;em>does&lt;/em> avoid screen tearing not just in Firefox
but in every application, it comes with a performance penalty in OpenGL
applications as well as increasing the time needed for the GPU to &amp;ldquo;clock down&amp;rdquo;
i.e: bring its frequency back down due to changing power states after some
rendering task is finished.&lt;/p>
&lt;p>Since in my case I&amp;rsquo;ve only noticed the screen tearing in Firefox, it seemed
like a no-brainer opt for this approach.&lt;/p>
&lt;p>To change I simply needed to go to the advanced preferences page of Firefox
reached by navigating to &lt;code>about:config&lt;/code> in the browser, search for
&lt;code>layers.acceleration.force-enabled&lt;/code>, set it to &lt;code>true&lt;/code> and restart Firefox.&lt;/p>
&lt;p>Voilà.&lt;/p>
&lt;p>Side note: The reason why GPU Acceleration is disabled by default in Firefox
on most, if not all Linux distributions is because WebGL is considered by many
as a security risk. For more a detailed explanation &lt;a href="https://security.stackexchange.com/questions/13799/is-webgl-a-security-concern">check this
security.stackexchange
answer&lt;/a>&lt;/p>
- https://www.antoniojgutierrez.com/posts/2020-05-04-firefox_screen_tearing_while_scrolling/ - Antonio Gutierrez 2020. CC-BY-NC 4.0</description></item><item><title>Mounting/Playing/Ripping audio CDs like it's 1995 (in Arch Linux)</title><link>https://www.antoniojgutierrez.com/posts/2020-02-01-ripping_audio_cds_like_its_1995/</link><pubDate>Sat, 01 Feb 2020 00:00:00 +0000</pubDate><guid>https://www.antoniojgutierrez.com/posts/2020-02-01-ripping_audio_cds_like_its_1995/</guid><description>Bits and pieces https://www.antoniojgutierrez.com/posts/2020-02-01-ripping_audio_cds_like_its_1995/ -&lt;p>First post of the year! Yey!&lt;/p>
&lt;p>Like many other posts, the motivation of this one is to facilitate other
people running into the same issues as me, to quickly find
their solution.&lt;/p>
&lt;p>So here&amp;rsquo;s the problem statement:&lt;/p>
&lt;p>You want to play an audio CD in an Arch Laptop or simply get the audio files. What do you do?&lt;/p>
&lt;p>Well first you buy an external CD/DVD ROM player, which you can connect (and
power) through USB.&lt;/p>
&lt;p>Then you should mount it, to later get the files or simply rip them, right?&amp;hellip;&lt;/p>
&lt;p>If you assume that mounting a CD ROM is exactly the same as mounting a
USB, then you would just connect the CD ROM player to the laptop, insert the
CD and
mount it with a command like:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">sudo mount /dev/sr0 /mnt/cdrom
&lt;/code>&lt;/pre>&lt;/div>&lt;p>But you would get an error:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">mount: /mnt/cdrom: can&lt;span style="color:#a61717;background-color:#e3d2d2">&amp;#39;&lt;/span>t &lt;span style="color:#658b00">read&lt;/span> superblock on /dev/sr0.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>So you search online the error and realize that it&amp;rsquo;s due to the fact that CD
doesn&amp;rsquo;t use the same filesystem as the laptop, which by default for most
distros is ext4. CDs/DVDs use a different filesystem. That filesystem is
ISO9660, which is the regular filesystem for optical media.&lt;/p>
&lt;p>So now you search online: for something like &lt;em>&amp;ldquo;mount+CD+ROM+linux&amp;rdquo;&lt;/em>, which tells you the right command is:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">mount -t iso9660 -o ro /dev/sr0 /mnt/cdrom
&lt;/code>&lt;/pre>&lt;/div>&lt;p>But when you try it, you get this error:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">mount: /mnt/cdrom: wrong fs type, bad option, bad superblock on /dev/sr0, missing codepage or helper program, or other
error.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then you wonder if it&amp;rsquo;s a hardware issue and you look for the message buffer
of the kernel, using &lt;code>dmesg&lt;/code> and find some errors like:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">[ 4325.239696] sr 1:0:0:0: [sr0] tag#0 FAILED Result: &lt;span style="color:#00688b">hostbyte&lt;/span>=DID_OK &lt;span style="color:#00688b">driverbyte&lt;/span>=DRIVER_SENSE
[ 4325.239708] sr 1:0:0:0: [sr0] tag#0 Sense Key : Illegal Request [current]
[ 4325.239718] sr 1:0:0:0: [sr0] tag#0 Add. Sense: Illegal mode &lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> this track
[ 4325.239729] sr 1:0:0:0: [sr0] tag#0 CDB: Read(10) &lt;span style="color:#b452cd">28&lt;/span> &lt;span style="color:#b452cd">00&lt;/span> &lt;span style="color:#b452cd">00&lt;/span> &lt;span style="color:#b452cd">04&lt;/span> 0c &lt;span style="color:#b452cd">60&lt;/span> &lt;span style="color:#b452cd">00&lt;/span> &lt;span style="color:#b452cd">00&lt;/span> &lt;span style="color:#b452cd">02&lt;/span> &lt;span style="color:#b452cd">00&lt;/span> &lt;span style="color:#b452cd">00&lt;/span> &lt;span style="color:#b452cd">00&lt;/span>
[ 4325.239741] blk_update_request: I/O error, dev sr0, sector &lt;span style="color:#b452cd">1061248&lt;/span> op 0x0:(READ) flags 0x80700 phys_seg &lt;span style="color:#b452cd">1&lt;/span> prio class
&lt;span style="color:#b452cd">0&lt;/span>
[ 4325.241965] attempt to access beyond end of device
[ 4325.241974] sr0: &lt;span style="color:#00688b">rw&lt;/span>=0, &lt;span style="color:#00688b">want&lt;/span>=1061256, &lt;span style="color:#00688b">limit&lt;/span>=&lt;span style="color:#b452cd">1061248&lt;/span>
[ 4325.241982] Buffer I/O error on dev sr0, logical block 132656, async page &lt;span style="color:#658b00">read&lt;/span>
[ 4325.242014] blk_update_request: I/O error, dev loop0, sector &lt;span style="color:#b452cd">1061248&lt;/span> op 0x0:(READ) flags 0x80700 phys_seg &lt;span style="color:#b452cd">1&lt;/span> prio cla
ss &lt;span style="color:#b452cd">0&lt;/span>
[ 4325.243811] attempt to access beyond end of device
[ 4325.243820] sr0: &lt;span style="color:#00688b">rw&lt;/span>=0, &lt;span style="color:#00688b">want&lt;/span>=1061256, &lt;span style="color:#00688b">limit&lt;/span>=&lt;span style="color:#b452cd">1061248&lt;/span>
[ 4325.243828] Buffer I/O error on dev sr0, logical block 132656, async page &lt;span style="color:#658b00">read&lt;/span>
[ 4325.243855] blk_update_request: I/O error, dev loop0, sector &lt;span style="color:#b452cd">1061248&lt;/span> op 0x0:(READ) flags 0x0 phys_seg &lt;span style="color:#b452cd">1&lt;/span> prio class &lt;span style="color:#b452cd">0&lt;/span>
[ 4325.243862] Buffer I/O error on dev loop0, logical block 530624, async page &lt;span style="color:#658b00">read&lt;/span>
[ 4325.243880] attempt to access beyond end of device
[ 4325.243885] sr0: &lt;span style="color:#00688b">rw&lt;/span>=0, &lt;span style="color:#00688b">want&lt;/span>=1061256, &lt;span style="color:#00688b">limit&lt;/span>=&lt;span style="color:#b452cd">1061248&lt;/span>
[ 4325.243890] Buffer I/O error on dev sr0, logical block 132656, async page &lt;span style="color:#658b00">read&lt;/span>
[ 4325.243904] blk_update_request: I/O error, dev loop0, sector &lt;span style="color:#b452cd">1061250&lt;/span> op 0x0:(READ) flags 0x0 phys_seg &lt;span style="color:#b452cd">1&lt;/span> prio class &lt;span style="color:#b452cd">0&lt;/span>
[ 4325.243909] Buffer I/O error on dev loop0, logical block 530625, async page &lt;span style="color:#658b00">read&lt;/span>
[ 4325.243919] attempt to access beyond end of device
[ 4325.243924] sr0: &lt;span style="color:#00688b">rw&lt;/span>=0, &lt;span style="color:#00688b">want&lt;/span>=1061256, &lt;span style="color:#00688b">limit&lt;/span>=&lt;span style="color:#b452cd">1061248&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Which suggest we are still trying to mount it wrongly.&lt;/p>
&lt;p>At which point you then start searching for: &lt;em>&amp;ldquo;mount+Audio+CD+linux&amp;rdquo;&lt;/em>, which
leads you to this &lt;a href="https://unix.stackexchange.com/a/204032">answer in unix
stackexchange&lt;/a>, which explains that
you &lt;strong>can&amp;rsquo;t&lt;/strong> mount Audio CDs, you simply &lt;em>play them directly&lt;/em>.&lt;/p>
&lt;p>You can try the command in the answer to verify that it in fact works:&lt;/p>
&lt;pre>&lt;code>mplayer -cdrom-device /dev/cdrom -cache 5000 cdda://1
&lt;/code>&lt;/pre>&lt;p>This should get the ROM spinning and you would start hearing one of the audio tracks.&lt;/p>
&lt;p>Ok so &lt;strong>Audio CDs can&amp;rsquo;t be mounted&lt;/strong>, so you skip to the second part, which is ripping the tracks.&lt;/p>
&lt;p>As usual, the ArchWiki has the answer. 99% of the times you have an issue in an
Arch installation it is already addressed in one article or another, but it
never ceases to surprise me how wide their breadth of topics is!&lt;/p>
&lt;p>The article: &lt;a href="https://wiki.archlinux.org/index.php/Rip_Audio_CDs#Ripping">Rip Audio
CDs&lt;/a>, has the
command that would get you all tracks, which requires installing &lt;code>cdrtools&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">cdda2wav -vall &lt;span style="color:#00688b">cddb&lt;/span>=&lt;span style="color:#b452cd">0&lt;/span> &lt;span style="color:#00688b">speed&lt;/span>=&lt;span style="color:#b452cd">4&lt;/span> -paranoia &lt;span style="color:#00688b">paraopts&lt;/span>=proof -B -D /dev/sr0
&lt;/code>&lt;/pre>&lt;/div>&lt;p>That will get your CD ROM spinning and after some minutes all the tracks in
your current directory as wav files.&lt;/p>
&lt;p>There&amp;rsquo;s more information in the article in case you would like to encode them
into other formats, like mp3 or flac.&lt;/p>
&lt;p>Happy listening!&lt;/p>
- https://www.antoniojgutierrez.com/posts/2020-02-01-ripping_audio_cds_like_its_1995/ - Antonio Gutierrez 2020. CC-BY-NC 4.0</description></item><item><title>Backing up Google Authenticators's Keys from an Android Phone</title><link>https://www.antoniojgutierrez.com/posts/2019-12-15-backing_up_google_authenticator_keys/</link><pubDate>Sun, 15 Dec 2019 00:00:00 +0000</pubDate><guid>https://www.antoniojgutierrez.com/posts/2019-12-15-backing_up_google_authenticator_keys/</guid><description>Bits and pieces https://www.antoniojgutierrez.com/posts/2019-12-15-backing_up_google_authenticator_keys/ -&lt;p>I wanted to backup my 2FA codes stored in Google&amp;rsquo;s Authenticator app. I don&amp;rsquo;t
want lose access to my accounts, in case I lose that phone.&lt;/p>
&lt;p>Sure there are also the backup codes, which are given/shown whenever 2FA is
set up, and are intended to be used on a rainy day such as when your
phone dies, gets stolen, or simply wiped accidentally or even on purpose but
they just forgot about the 2FA codes living there (not speaking from personal
experience at all of course :cry: ). Unfortunately, many people don&amp;rsquo;t pay too
much attention to these, myself included.&lt;/p>
&lt;p>I &lt;strong>strongly encourage you to store those backup codes&lt;/strong> because you
never know when you&amp;rsquo;re going to need them. They have saved me in the past
from being able to access an account when my phone battery died, I had no
charger and needed to access it urgently.&lt;/p>
&lt;p>But in those cases where everything goes wrong, well you just have to reset
all accounts where you have 2FA, i.e: reset passwords and somehow prove that
you are who you say you are and not a malicious attacker that obtained the
passwords for those accounts (which is kind of a tricky situation for many
services since they don&amp;rsquo;t want to be accidentally victims of a social
engineering attack trying to collaborate with the so-claimed user).&lt;/p>
&lt;p>Hopefully this serves as enough warning and encouragement to backup your 2FA
or simply write down the backup codes. If you get anything out of this post,
let it be that.&lt;/p>
&lt;p>Now back to backing up the 2FA keys in Google Authenticator (GA) app: the main
advantage of this approach being that you don&amp;rsquo;t have to change/edit or add any
new device into any of your accounts, but instead you simply add the keys
manually to another 2FA app whether it lives in app in your phone, a desktop
app or somewhere else.&lt;/p>
&lt;p>You also don&amp;rsquo;t need to use any of your &lt;em>limited&lt;/em> backup codes in case you need
access and don&amp;rsquo;t have that one phone with all the 2FA keys at hand in that
moment.&lt;/p>
&lt;h1 id="prerequisites">Prerequisites&lt;/h1>
&lt;p>This guide assumes you have rooted your Android phone.&lt;/p>
&lt;p>If you don&amp;rsquo;t want to do this due to security concerns, then your only option
is to use the backup codes and that&amp;rsquo;s the end of this road for you.&lt;/p>
&lt;p>If you don&amp;rsquo;t mind rooting your phone, and you haven&amp;rsquo;t there are many ways of
doing so, a simple duckduckgo search will lead you down the rabbithole.&lt;/p>
&lt;p>In addition we will need
&lt;a href="https://developer.android.com/studio/command-line/adb">adb&lt;/a> adb i.e: android
debug bridge. This is part of
the &lt;code>android-tools&lt;/code> package in Arch Linux. You can also download and install
it as part of the platform-tools from the &lt;a href="https://developer.android.com/studio/releases/platform-tools">Android
website&lt;/a>&lt;/p>
&lt;p>This guide also assumes your phone is connected to the computer and you have
USB debugging enabled (For more detailed steps please check this &lt;a href="https://developer.android.com/studio/debug/dev-options">official
android guide&lt;/a>.&lt;/p>
&lt;h1 id="run-adb-as-root">Run adb as root&lt;/h1>
&lt;p>First of we need to run adb as root. This is easier said that done.&lt;/p>
&lt;p>For this we can run &lt;code>adb root&lt;/code> in a terminal, but it might be the case that after we do that
and try to fetch GA&amp;rsquo;s database we get the following error:&lt;/p>
&lt;pre>&lt;code>$ adb pull /data/data/com.google.android.apps.authenticator2/databases/databases
adb: error: failed to stat remote object '/data/data/com.google.android.apps.authenticator2/databases/databases': Permission denied
&lt;/code>&lt;/pre>&lt;pre>&lt;code>$ sudo adb shell
AndroidPhone:/ $ ls -lh
ls: ./init.rc: Permission denied
ls: ./init: Permission denied
ls: ./ueventd.rc: Permission denied
&lt;/code>&lt;/pre>&lt;p>You can also tell that the session is &lt;strong>not&lt;/strong> a root session because the
prompt ends with &lt;code>$&lt;/code> instead of &lt;code>#&lt;/code>.&lt;/p>
&lt;pre>&lt;code>$ adb root
adbd cannot run as root in production builds
&lt;/code>&lt;/pre>&lt;pre>&lt;code>$ adb shell &amp;quot;su&amp;quot;
Permission denied
&lt;/code>&lt;/pre>&lt;p>In my particular case, this is an issue caused of having Magisck Hide enabled,
mentioned in this &lt;a href="https://github.com/topjohnwu/Magisk/issues/425#issuecomment-409101558">Github
issue&lt;/a>.&lt;/p>
&lt;p>In case you&amp;rsquo;re wondering Magisck Hide is part of
&lt;a href="https://www.xda-developers.com/how-to-use-magisk/">Magisck&lt;/a> and is a feature
that &amp;ldquo;&lt;em>allows you put a cloaking device on root permissions for certain
apps.&lt;/em>&amp;rdquo;. Very useful for banking apps, for instance, which don&amp;rsquo;t allow you to
login on a rooted device.&lt;/p>
&lt;p>So I decided to disable Magisck Hide for now and reboot.&lt;/p>
&lt;p>Afterwards I was able to start an adb root session:&lt;/p>
&lt;pre>&lt;code>$ adb root
restarting adbd as root
timeout expired while waiting for device
&lt;/code>&lt;/pre>&lt;p>And then checking the prompt for the &lt;code>#&lt;/code> at the end.&lt;/p>
&lt;pre>&lt;code>$ adb shell
OnePlus3:/ # ls -lh
total 2.7M
dr-xr-xr-x 90 root root 0 1972-06-20 21:28 acct
lrwxrwxrwx 1 root root 11 1970-01-01 01:00 bin -&amp;gt; /system/bin
lrwxrwxrwx 1 root root 19 1970-01-01 01:00 bt_firmware -&amp;gt; /vendor/bt_firmware
lrwxrwxrwx 1 root root 50 1970-01-01 01:00 bugreports -&amp;gt; /data/user_de/0/com.android.shell/files/bugreports
&lt;/code>&lt;/pre>&lt;h1 id="fetching-the-database">Fetching the database&lt;/h1>
&lt;p>Afterwards I was able to pull the database, and I noticed that it hadn&amp;rsquo;t been
modified since many months ago, even though I had recently added new 2FA entries,
after trying to open it I only found a handful of 2FA keys, but I also noticed
something else.&lt;/p>
&lt;p>There were two additional files next to the &lt;code>database&lt;/code> file: a &lt;code>-wal&lt;/code> and a &lt;code>-shm&lt;/code> file.&lt;/p>
&lt;p>After some more duckduckgo searching I found a well written in a well written and
useful &lt;a href="https://medium.com/@Zredna/browsing-your-android-apps-database-3c67aa3f4a3c">Medium
post&lt;/a>
by &lt;a href="https://medium.com/@Zredna">@Zredna&lt;/a>, in which he explore sqlite
databases in android apps.&lt;/p>
&lt;p>In it he explains that the &lt;code>-wal&lt;/code> file, is used for the &lt;a href="https://en.wikipedia.org/wiki/Write-ahead_logging">write-ahead
logging&lt;/a>, which is a
technique for providing atomicity and durability in databases, part of the
&lt;a href="https://en.wikipedia.org/wiki/ACID">ACID properties&lt;/a>, and Wikipedia explains
that the technique relies on first writing the changes in the log &lt;strong>before&lt;/strong>
writing them in the database. Kind of the equivalent of journaling in filesystems.
In short the directory looked something like this:&lt;/p>
&lt;pre>&lt;code>OnePlus3:/data/data/com.google.android.apps.authenticator2/databases# ls -lh
total 2.7M
lrwxrwxrwx 1 root root 6K 1970-01-01 01:00 databases
lrwxrwxrwx 1 root root 80 1970-01-01 01:00 databases-shm
lrwxrwxrwx 1 root root 10K 1970-01-01 01:00 databases-wal
&lt;/code>&lt;/pre>&lt;p>As to the meaning of the &lt;code>-shm&lt;/code> file, that is a &lt;strong>shared-memory file&lt;/strong> and is
used by the sqlite databases when operating in WAL mode, used as an index of
the WAL file. You can read more about it the [sqlite tempfiles
documentation](here: &lt;a href="https://www.sqlite.org/tempfiles.html">https://www.sqlite.org/tempfiles.html&lt;/a>)&lt;/p>
&lt;p>So that required actually fetching both of those extra files in order to get a
complete picture of the current database state.&lt;/p>
&lt;h1 id="opening-the-database">Opening the database&lt;/h1>
&lt;p>As per the blog, we need to commit the changes from the &lt;code>wal&lt;/code> file to the
database file, in order to do that we run the command:&lt;/p>
&lt;pre>&lt;code>sqlite3 app.db &amp;quot;PRAGMA wal_checkpoint&amp;quot;
&lt;/code>&lt;/pre>&lt;p>Afterwards, we can open the database using an interactive sqlite session,
select all the entries from the &lt;code>account&lt;/code> table:&lt;/p>
&lt;pre>&lt;code>$ sqlite3 ./databases
SQLite version 3.31.1 2019-12-10 19:55:54
Enter &amp;quot;.help&amp;quot; for usage hints.
sqlite&amp;gt; select * from accounts;
&lt;/code>&lt;/pre>&lt;p>Or simply save all the values without an interactive session to another file:&lt;/p>
&lt;pre>&lt;code>sqlite3 databases 'select * from accounts' &amp;gt; 2fa_accounts
&lt;/code>&lt;/pre>&lt;p>Which will write a table representation that looks like this:&lt;/p>
&lt;pre>&lt;code>$ cat 2fa_accounts
1|Github|asdf12345asdf|0|0|0||Github
2|Twitch|deadbeef101010|0|0|0||Twitch
&lt;/code>&lt;/pre>&lt;p>And the 2FA private keys would be the &lt;strong>deadbeef101010&lt;/strong> and the
&lt;strong>asdf12345asdf&lt;/strong> in this case, which you can then now use in case you move to
a different phone.&lt;/p>
&lt;p>That&amp;rsquo;s it! Hope that helps you in some way!&lt;/p>
&lt;p>PS: These are &lt;strong>not real 2FA private keys&lt;/strong> in case you&amp;rsquo;re wondering, potential hacker.&lt;/p>
- https://www.antoniojgutierrez.com/posts/2019-12-15-backing_up_google_authenticator_keys/ - Antonio Gutierrez 2020. CC-BY-NC 4.0</description></item><item><title>Using a credential store for DockerHub login</title><link>https://www.antoniojgutierrez.com/posts/2018-08-11-docker_login_password_store/</link><pubDate>Sat, 11 Aug 2018 00:00:00 +0000</pubDate><guid>https://www.antoniojgutierrez.com/posts/2018-08-11-docker_login_password_store/</guid><description>Bits and pieces https://www.antoniojgutierrez.com/posts/2018-08-11-docker_login_password_store/ -&lt;p>Whenever there&amp;rsquo;s a need to push images (public or private) or pull images from
privates repositories from DockerHub you need to login first. With the docker
client CLI that&amp;rsquo;s achieved with:&lt;/p>
&lt;pre>&lt;code>docker login
&lt;/code>&lt;/pre>&lt;p>It then asks for the credentials to use for logging in.
The problem with this approach is explicitly mentioned in output of that
command.&lt;/p>
&lt;p>In my case:&lt;/p>
&lt;pre>&lt;code>Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.
Username: chibby0ne
Password:
WARNING! Your password will be stored unencrypted in /home/turing/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store
&lt;/code>&lt;/pre>&lt;p>The password is stored unencrypted (although not in plain-text).&lt;/p>
&lt;p>Visiting the link you will find there are a number of docker-credentials
helpers in &lt;a href="https://github.com/docker/docker-credential-helpers">docker-credentials-helpers&lt;/a> for every Operating
System.&lt;/p>
&lt;p>For Linux, I decided to go with &lt;a href="https://www.passwordstore.org/">pass&lt;/a> and use the appropriate
docker-credential-helper for it.&lt;/p>
&lt;p>Pass is a password store that keeps passwords in a GPG encrypted file.&lt;/p>
&lt;p>The steps to set it up are very straightforward:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Install &lt;code>pass&lt;/code>&lt;/p>
&lt;p>Install &lt;code>pass&lt;/code> using your package manager if its available, otherwise download
a release and install it using &lt;code>make install&lt;/code>&lt;/p>
&lt;p>You can find all the options in the official website: &lt;a href="https://www.passwordstore.org/">pass&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Install &lt;code>docker-credential-pass&lt;/code>&lt;/p>
&lt;p>You need a Go installation to build the binaries. If you don&amp;rsquo;t have one yet
just install it using your package manager, and set the &lt;code>GOPATH&lt;/code> environment
variable to the place where you want to have your go projects. For more
information visit:&lt;/p>
&lt;p>Assuming you have a Go installation then:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Fetch the sources with:&lt;/p>
&lt;pre>&lt;code>go get github.com/docker/docker-credential-helpers
&lt;/code>&lt;/pre>&lt;p>This will download the repo and place it in
&lt;code>$GOPATH/src/github.com/docker/docker-credential-helpers&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Build the helper that uses pass by running:&lt;/p>
&lt;pre>&lt;code>make pass
&lt;/code>&lt;/pre>&lt;p>The binary &lt;code>docker-credential-pass&lt;/code> will be located in the &lt;code>bin/&lt;/code> directory.
You need to copy the binary to a directory included in the &lt;code>PATH&lt;/code> environment so
that the docker client CLI can actually find it.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Log out&lt;/p>
&lt;p>Run &lt;code>docker logout&lt;/code>.&lt;/p>
&lt;p>If you where already logged in you should see:&lt;/p>
&lt;pre>&lt;code>Removing login credentials for https://index.docker.io/v1/
&lt;/code>&lt;/pre>&lt;p>If you where not logged in, you should see:&lt;/p>
&lt;pre>&lt;code>Not logged in to https://index.docker.io/v1/
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>Modify the &lt;code>~/.docker/config.json&lt;/code> to use the &lt;code>docker-credential-pass&lt;/code>&lt;/p>
&lt;p>Add the following key/value pair:&lt;/p>
&lt;pre>&lt;code> &amp;quot;credsStore&amp;quot;: &amp;quot;pass&amp;quot;
&lt;/code>&lt;/pre>&lt;p>By now your &lt;code>~/.docker/config.json&lt;/code> should look something like this
(User-Agent might be different):&lt;/p>
&lt;pre>&lt;code>{
&amp;quot;auths&amp;quot;: {},
&amp;quot;HttpHeaders&amp;quot;: {
&amp;quot;User-Agent&amp;quot;: &amp;quot;Docker-Client/18.05.0-ce (linux)&amp;quot;
},
&amp;quot;credsStore&amp;quot;: &amp;quot;pass&amp;quot;
}
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>Initialize &lt;code>pass&lt;/code>&lt;/p>
&lt;p>You need to tell pass which GPG keypair you&amp;rsquo;re going to use to encrypt/decrypt
the password.&lt;/p>
&lt;p>Run:&lt;/p>
&lt;pre>&lt;code>pass init GPG_ID
&lt;/code>&lt;/pre>&lt;p>Where GPG_ID is the fingerprint or email address that identifies the key.&lt;/p>
&lt;p>If you don&amp;rsquo;t have a GPG keypair yet, then proceed to create it using:
&lt;code>gpg --full-gen-key&lt;/code> and configure the settings using the interactive prompt.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Login&lt;/p>
&lt;p>Run &lt;code>docker login&lt;/code> and enter your credentials, but this time after entering
the username and password, you should see a prompt to enter the password for
the selected GPG key.&lt;/p>
&lt;p>Important to note is that the output should not have the warning message
anymore.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Done!&lt;/p>
&lt;p>That&amp;rsquo;s it. Now the you are logged in but the credentials are not stored
unencrypted in the &lt;code>~/.docker/config.json&lt;/code> file.&lt;/p>
&lt;/li>
&lt;/ol>
- https://www.antoniojgutierrez.com/posts/2018-08-11-docker_login_password_store/ - Antonio Gutierrez 2020. CC-BY-NC 4.0</description></item><item><title>Installing Tensorflow with GPU acceleration in Arch</title><link>https://www.antoniojgutierrez.com/posts/2018-05-11-installing_tensorflow_with_gpu_in_arch/</link><pubDate>Fri, 11 May 2018 00:00:00 +0000</pubDate><guid>https://www.antoniojgutierrez.com/posts/2018-05-11-installing_tensorflow_with_gpu_in_arch/</guid><description>Bits and pieces https://www.antoniojgutierrez.com/posts/2018-05-11-installing_tensorflow_with_gpu_in_arch/ -&lt;p>I recently started doing the &lt;a href="https://www.fast.ai">fast.ai&lt;/a> course where you follow a top-down
approach into the world of machine learning.&lt;/p>
&lt;p>The first thing you need to do is have access to a Nvidia GPU, and in the
first video lesson they show the setup of a cloud instance that runs
Tensorflow using either &lt;a href="https://www.crestle.com">crestle&lt;/a> or
&lt;a href="https://www.paperspace.com">paperspace&lt;/a>.&lt;/p>
&lt;p>But since either of them are paid by the hour, and considering I already have
Nvidia GPU in my desktop (albeit not as powerful as the ones offered in the
aforementioned services, just an GTX 1070), I thought of going in a tangent
and setting it up myself.&lt;/p>
&lt;p>The first thing to do is install Tensorflow.&lt;/p>
&lt;p>I already had CUDA installed, so I proceeded to install Tensorflow.&lt;/p>
&lt;p>There was a problem: the CUDA version was too bleeding edge for the Tensroflow
version. Tensorflow 1.9 requires CUDA 9.0 and the latest CUDA in Arch
repositories was 9.1.&lt;/p>
&lt;p>I thought of compiling Tensorflow myself, since that would make it work with
9.1. But that would take a long time and probably space as well.&lt;/p>
&lt;p>Instead I opted out for a docker image which required &lt;a href="https://aur.archlinux.org/packages/nvidia-docker/">nvidia-docker&lt;/a> from AUR,
and rebooting the docker-service. Then I followed the instructions found in
the &lt;a href="https://github.com/NVIDIA/nvidia-docker">github repository&lt;/a> to run the
image after it pulled it. Afterwards, I started a Jupyter Notebook that
required a token to login, which was specified in the output of the jupyter
command line prompt.&lt;/p>
&lt;p>Once inside the jupyter notebook, I was finally able to run Tensroflow with
GPU acceleration.&lt;/p>
&lt;p>Simple enough if you know where to look. But even if digging up took some
time, is time well spent considering the speedup achieved with GPU
acceleration when using Tensorflow.&lt;/p>
- https://www.antoniojgutierrez.com/posts/2018-05-11-installing_tensorflow_with_gpu_in_arch/ - Antonio Gutierrez 2020. CC-BY-NC 4.0</description></item><item><title>Log base 10 vs Log base e notation</title><link>https://www.antoniojgutierrez.com/posts/2018-05-07-log_base_10_vs_log_base_e_notation/</link><pubDate>Mon, 07 May 2018 00:00:00 +0000</pubDate><guid>https://www.antoniojgutierrez.com/posts/2018-05-07-log_base_10_vs_log_base_e_notation/</guid><description>Bits and pieces https://www.antoniojgutierrez.com/posts/2018-05-07-log_base_10_vs_log_base_e_notation/ -&lt;p>I wrote this post after struggling for a few hours with the derivation of the negative log-likelihood function , and finding out that the derivative didn&amp;rsquo;t match what was expected, only to find out that it was indeed matching and that instead, there&amp;rsquo;s a discrepancy on the semantics of the &amp;ldquo;&lt;strong>log&lt;/strong>&amp;rdquo; notation.&lt;/p>
&lt;p>Let&amp;rsquo;s go step by step:&lt;/p>
&lt;p>Two of the most common logarithms are the logarithm of base $$e$$, also called
natural logarithm which is written in two forms:&lt;/p>
&lt;p>$$\ln{x} = \log_{e}{x}$$&lt;/p>
&lt;p>and the logarithm of base 10 also called common logarithm or decimal
logarithm:&lt;/p>
&lt;p>$$ \log_{10}{x}$$&lt;/p>
&lt;p>Additionally scientific calculators have a &amp;ldquo;&lt;strong>log&lt;/strong>&amp;rdquo; and a &amp;ldquo;&lt;strong>ln&lt;/strong>&amp;rdquo; function,
which apply the logarithm of base 10 and the logarithm of base $$e$$ respectively:&lt;/p>
&lt;p>&lt;img src="https://upload.wikimedia.org/wikipedia/commons/8/88/Logarithm_keys.jpg" alt="log keys in calculator">&lt;/p>
&lt;h5 id="by-waifer-x---100502-1150494uploaded-by-pieter-kuiper-cc-by-20-httpscommonswikimediaorgwindexphpcurid10715338">By Waifer X - 100502-1150494Uploaded by Pieter Kuiper, CC BY 2.0, &lt;a href="https://commons.wikimedia.org/w/index.php?curid=10715338">https://commons.wikimedia.org/w/index.php?curid=10715338&lt;/a>&lt;/h5>
&lt;p>But something that I learned while checking for errors doing the derivative is that mathematicians and calculator designers
have different things in mind when writing &amp;ldquo;&lt;strong>log&lt;/strong>&amp;quot;:&lt;/p>
&lt;p>From Wikipedia&amp;rsquo;s &lt;a href="https://en.wikipedia.org/wiki/Common_logarithm">Common Logarithm&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>On calculators it is usually &amp;ldquo;log&amp;rdquo;, but mathematicians usually mean natural logarithm (logarithm with base e ≈ 2.71828) rather than common logarithm when they write &amp;ldquo;log&amp;rdquo;. To mitigate this ambiguity the ISO 80000 specification recommends that $$log_{10}{x}$$ should be written $$lg{x}$$ and $$log_{e}{x}$$ should be $$ln{x}$$.&lt;/p>
&lt;/blockquote>
&lt;p>And from Wikipedia&amp;rsquo;s &lt;a href="https://en.wikipedia.org/wiki/Natural_logarithm">Natural Logarithm&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>The natural logarithm of x is generally written as $$ln x$$, $$log_{e} x$$, or sometimes, if the base $$e$$ is implicit, simply $$log x$$.&lt;/p>
&lt;/blockquote>
&lt;p>Therefore in the case of the negative log-likelihood function:&lt;/p>
&lt;p>$$ L(\boldsymbol{y}) = - \log(\boldsymbol{y}) $$&lt;/p>
&lt;p>Although it&amp;rsquo;s not implicit that it refers to a logarithm of base $$e$$, &lt;em>it is
indeed the natural logarithm&lt;/em>, it&amp;rsquo;s just being used as mentioned in the given
excerpt of common logarithm (i.e: mathematicians usually mean natural logarithm when they write &amp;ldquo;log&amp;rdquo;), and therefore its derivative is:&lt;/p>
&lt;p>$$ \dfrac{\partial L_{\boldsymbol{y}}}{\partial \boldsymbol{y}} = -\dfrac{1}{\boldsymbol{y}} $$&lt;/p>
&lt;p>Mathematicians be crazy!&lt;/p>
- https://www.antoniojgutierrez.com/posts/2018-05-07-log_base_10_vs_log_base_e_notation/ - Antonio Gutierrez 2020. CC-BY-NC 4.0</description></item><item><title>Using Javascript completion including adding Google Chrome API in vim</title><link>https://www.antoniojgutierrez.com/posts/2018-04-20-vim-ycm-tern-chrome-extension/</link><pubDate>Fri, 20 Apr 2018 00:00:00 +0000</pubDate><guid>https://www.antoniojgutierrez.com/posts/2018-04-20-vim-ycm-tern-chrome-extension/</guid><description>Bits and pieces https://www.antoniojgutierrez.com/posts/2018-04-20-vim-ycm-tern-chrome-extension/ -&lt;p>&lt;a href="https://github.com/Valloric/YouCompleteMe">YouCompleteMe&lt;/a> is a very powerful code completion engine built
for the vim editor. It has several completion engines for many languages
including C/C++, Rust, Go, Python, Javascript among others. It contains two
parts: a vim-plugin and a daemon.&lt;/p>
&lt;p>A very simple explanation of how YouCompleteMe works is by starting a server
whenever a file is opened whose filetype corresponds to one of the installed
languages engines. After this, the file is analyzed by communicating with from
vim using the vim plugin (client) to the daemon (server).
&lt;em>The languages for which YouCompleteMe provides auto completion are selected
are install time, therefore if you don&amp;rsquo;t explicitly install it selecting a
language, autocompletion for that language will probably be disabled.&lt;/em>&lt;/p>
&lt;p>For Javascript, &lt;a href="http://ternjs.net/">tern&lt;/a> is used for the code analysis. Tern itself
requires a &lt;code>.tern-project&lt;/code> or a &lt;code>.tern-config&lt;/code> file describing the specific
configuration in the root of the project or above or the home directory
respectively. Tern then opens a server in a unused port that listens for POST
requests from a client that asks questions about the code in the form of JSON.&lt;/p>
&lt;p>When vim is started is runs tern in a separate process and starts the
querying whenever possible as described before.&lt;/p>
&lt;p>In addition, tern supports server plugins, which are normal Javascript
programs that add extra functionality to the server. There are a few plugins
that come with the distribution such as doc and nodejs.&lt;/p>
&lt;p>Now what if I wanted to develop a Chrome Extension and wanted the
autocompletion for the Chrome API in vim?&lt;/p>
&lt;p>Well since tern supports this it would be only a matter of installing the tern
plugin and adding the plugin to the &lt;code>.tern-project&lt;/code>.&lt;/p>
&lt;p>First installing the tern Chrome Extension:
I found this &lt;a href="https://www.npmjs.com/package/tern-chrome-extension">tern-chrome-extension&lt;/a> which worked
pretty well.&lt;/p>
&lt;p>And we can&amp;rsquo;t just install it in the project directory that would install it in
the &lt;code>node modules&lt;/code> but vim(and tern) would be aware of it. We have to install it
in &lt;code>node_modules&lt;/code> of the tern instance that&amp;rsquo;s run by vim.&lt;/p>
&lt;p>To find it we run, with a vim instance reading a Javascript file:&lt;/p>
&lt;pre>&lt;code>ps aux | grep tern
&lt;/code>&lt;/pre>&lt;p>We find that the process is running as:&lt;/p>
&lt;pre>&lt;code>/usr/bin/node /home/user/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/tern_runtime/node_modules/tern/bin/tern --port 46973 --host 127.0.0.1 --persistent --no-port-file
&lt;/code>&lt;/pre>&lt;p>We want to navigate to this directory &lt;code>/home/user/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/tern_runtime/&lt;/code>, because the &lt;code>node_modules&lt;/code> is the place where we want it to be installed.&lt;/p>
&lt;p>We run:&lt;/p>
&lt;pre>&lt;code>npm install --prefix . tern-chrome-extension
&lt;/code>&lt;/pre>&lt;p>And we make sure everything went ok by checking if there&amp;rsquo;s a directory with
that name in &lt;code>node_modules&lt;/code> or in the &lt;code>package.json&lt;/code>&lt;/p>
&lt;pre>&lt;code>$ cat package.json
{
&amp;quot;description&amp;quot;: &amp;quot;ycmd tern runtime area with required tern version and plugins&amp;quot;,
&amp;quot;dependencies&amp;quot;: {
&amp;quot;tern&amp;quot;: &amp;quot;0.21.0&amp;quot;,
&amp;quot;tern-chrome-extension&amp;quot;: &amp;quot;^46.1.20160420&amp;quot;
}
}
&lt;/code>&lt;/pre>&lt;p>Now all that&amp;rsquo;s needed to create/edit the &lt;code>.tern-project&lt;/code> file, and add the
chrome-extension to the plugins section.&lt;/p>
&lt;pre>&lt;code>$ cat .tern-project
{
&amp;quot;libs&amp;quot;: [
&amp;quot;browser&amp;quot;,
&amp;quot;ecma5&amp;quot;
],
&amp;quot;plugins&amp;quot;: {
&amp;quot;node&amp;quot;: {},
&amp;quot;chrome-extension&amp;quot;: {}
}
}
&lt;/code>&lt;/pre>&lt;p>That&amp;rsquo;s it! Now you can enjoy having the Chrome API completion in vim.&lt;/p>
- https://www.antoniojgutierrez.com/posts/2018-04-20-vim-ycm-tern-chrome-extension/ - Antonio Gutierrez 2020. CC-BY-NC 4.0</description></item></channel></rss>